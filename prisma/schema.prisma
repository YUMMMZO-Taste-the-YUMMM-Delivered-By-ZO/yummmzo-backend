generator client {
  provider = "prisma-client-js"
  // output   = "../src/generated/prisma"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

// --- Enums ---

enum Role {
  ADMIN
  RESTAURANT_OWNER
  DELIVERY_PARTNER
  CUSTOMER
}

enum Restaurant_Status {
  OPEN
  CLOSED
  INACTIVE
}

enum Order_Status {
  PENDING
  CONFIRMED
  PREPARING
  READY
  OUT_FOR_DELIVERY
  DELIVERED
  CANCELLED
}

enum Payment_Status {
  PENDING
  COMPLETED
  FAILED
  REFUNDED
}

enum Payment_Method {
  ONLINE
  COD
}

enum Discount_Type {
  FLAT
  PERCENTAGE
}

// --- Models ---

model User {
  id              Int           @id @default(autoincrement())
  firstName       String        @db.VarChar(50)
  lastName        String        @db.VarChar(100)
  email           String        @unique @db.VarChar(200)
  phone           String        @unique @db.VarChar(15)
  password        String        @db.VarChar(300)
  avatar          String?       @db.VarChar(500)
  role            Role          @default(CUSTOMER)
  isEmailVerified Boolean       @default(false)
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  settings        User_Setting?
  addresses       Address[]
  orders          Order[]
  reviews         Review[]
}

model User_Setting {
  id                  Int      @id @default(autoincrement())
  userId              Int      @unique
  user                User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  isPushNotification  Boolean  @default(false)
  isEmailNotification Boolean  @default(true)
  isSMSNotification   Boolean  @default(false)
  isDarkMode          Boolean  @default(true)
  language            String   @default("English")
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
}

model Restaurant {
  id           Int               @id @default(autoincrement())
  name         String            @db.VarChar(100)
  description  String            @db.VarChar(500)
  image        String            @db.VarChar(500)
  images       Json              
  rating       Float             @default(0)
  totalRatings Int               @default(0)
  location     String            @db.VarChar(400)
  priceForTwo  Int
  deliveryTime String            @db.VarChar(50)
  status       Restaurant_Status @default(OPEN)
  createdAt    DateTime          @default(now())
  updatedAt    DateTime          @updatedAt
  categories   Category[]
  cuisines     Cuisine[]
  orders       Order[]
  reviews      Review[]
  coupons      Coupon[]
}

model Cuisine {
  id          Int          @id      @default(autoincrement())
  name        String       @unique  @db.VarChar(100)
  restaurants Restaurant[] 
}

model Category {
  id           Int        @id @default(autoincrement())
  restaurantId Int
  restaurant   Restaurant @relation(fields: [restaurantId], references: [id], onDelete: Cascade)
  name         String     @db.VarChar(100)
  description  String?    @db.VarChar(500)
  createdAt    DateTime   @default(now())
  items        Menu_Item[]
}

model Menu_Item {
  id          Int      @id @default(autoincrement())
  categoryId  Int
  category    Category @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  name        String   @db.VarChar(100)
  description String   @db.VarChar(500)
  price       Int
  image       String?  @db.VarChar(500)
  isVeg       Boolean  @default(true)
  inStock     Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  orderItems  Order_Item[]
}

model Address {
  id        Int      @id @default(autoincrement())
  userId    Int
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  type      String   @default("Home") @db.VarChar(50)
  address   String   @db.VarChar(500)
  city      String   @db.VarChar(50)
  state     String   @db.VarChar(50)
  pincode   String   @db.VarChar(10)
  latitude  Float?   
  longitude Float?
  name      String   @db.VarChar(100) 
  phone     String   @db.VarChar(15)  
  isDefault Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  orders    Order[]
}

model Order {
  id                 Int            @id @default(autoincrement())
  orderNumber        String         @unique @db.VarChar(50)
  userId             Int
  restaurantId       Int
  addressId          Int
  user               User           @relation(fields: [userId], references: [id])
  restaurant         Restaurant     @relation(fields: [restaurantId], references: [id])
  address            Address        @relation(fields: [addressId], references: [id])
  orderStatus        Order_Status   @default(PENDING)
  paymentMethod      Payment_Method @default(ONLINE)
  paymentStatus      Payment_Status @default(PENDING)
  razorpayOrderId    String?        @db.VarChar(100)
  razorpayPaymentId  String?        @db.VarChar(100)
  itemTotal          Int
  deliveryFee        Int            @default(0)
  packagingFee       Int            @default(0)
  gst                Float
  discount           Int            @default(0)
  total              Float
  couponId           Int?
  coupon             Coupon?        @relation(fields: [couponId], references: [id])
  items              Order_Item[]
  statusHistory      Order_Status_History[]
  payment            Payment?
  review             Review?
  createdAt          DateTime       @default(now())
  updatedAt          DateTime       @updatedAt
}

model Order_Item {
  id              Int       @id @default(autoincrement())
  orderId         Int
  menuItemId      Int
  order           Order     @relation(fields: [orderId], references: [id], onDelete: Cascade)
  menuItem        Menu_Item @relation(fields: [menuItemId], references: [id])
  name            String    @db.VarChar(100)
  price           Int
  quantity        Int
  itemTotal       Int
  customizations  Order_Item_Customization[]
}

model Order_Item_Customization {
  id           Int        @id @default(autoincrement())
  orderItemId  Int
  orderItem    Order_Item @relation(fields: [orderItemId], references: [id], onDelete: Cascade)
  name         String     @db.VarChar(100)
  price        Int        @default(0)
}

model Order_Status_History {
  id        Int          @id @default(autoincrement())
  orderId   Int
  order     Order        @relation(fields: [orderId], references: [id], onDelete: Cascade)
  status    Order_Status
  createdAt DateTime     @default(now())
}

model Payment {
  id                Int            @id @default(autoincrement())
  orderId           Int            @unique
  order             Order          @relation(fields: [orderId], references: [id])
  transactionId     String         @unique @db.VarChar(100)
  amount            Float
  status            Payment_Status
  paymentMethod     Payment_Method
  createdAt         DateTime       @default(now())
}

model Review {
  id           Int        @id @default(autoincrement())
  userId       Int
  restaurantId Int
  orderId      Int        @unique
  user         User       @relation(fields: [userId], references: [id])
  restaurant   Restaurant @relation(fields: [restaurantId], references: [id])
  order        Order      @relation(fields: [orderId], references: [id])
  rating       Float
  comment      String?    @db.VarChar(500)
  images       Json?      
  createdAt    DateTime   @default(now())
}

model Coupon {
  id               Int           @id @default(autoincrement())
  restaurantId     Int?          
  restaurant       Restaurant?   @relation(fields: [restaurantId], references: [id])
  code             String        @unique @db.VarChar(50)
  description      String        @db.VarChar(255)
  discountType     Discount_Type
  discountValue    Int
  maxDiscount      Int?
  minOrderValue    Int           @default(0)
  validFrom        DateTime
  validTill        DateTime
  isActive         Boolean       @default(true)
  orders           Order[]
}